---
import '../styles/global.css'
import { Font } from 'astro:assets';
---

<Font cssVariable="--font-funnel-sans" />
<Font cssVariable="--font-jetbrains-mono" />
<Font cssVariable="--font-funnel-display" />

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Monika Musielik</title>
		<meta name="description" content="Personal website of Monika Musielik. Creative coding, projects, and more.">
		<meta name="keywords" content="Monika Musielik, developer, personal website, portfolio">
		<meta name="author" content="Monika Musielik">

		<meta property="og:title" content="Monika Musielik" />
		<meta property="og:description" content="Personal website of Monika Musielik. Creative coding, projects, and more." />
		<meta property="og:image" content="/social-card.png" />
		<meta property="og:url" content="https://musielik.com" />
		<meta property="og:type" content="website" />

		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content="Monika Musielik" />
		<meta name="twitter:description" content="Personal website of Monika Musielik. Creative coding, projects, and more." />
		<meta name="twitter:image" content="/social-card.png" />
	</head>
	<body>
		<section class="font-display flex flex-col items-center justify-between h-[100svh] bg-background text-text">
			<canvas id="grid" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
			<div class="my-8 max-w-7xl w-header py-2 px-8 border-primary text-secondary rounded-md border-2 flex gap-2 flex-col items-center lg:flex-row font-mono justify-between">
				<div class="flex gap-2 items-center">
					<img id="weather_icon" src="" alt="" class="h-5" />
					<span id="weather">█ ██°C</span>
				</div>
				<a class="flex gap-2 items-center hover:underline underline-offset-2" id="spotify_link">
					<img id="spotify_cover" alt="" src="" class="h-5" />
					<span id="spotify">██████ • ██████</span>
				</a>
				<div class="flex gap-1 items-center">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock3-icon lucide-clock-3">
						<line id="hour-hand" x1="12" y1="12" x2="12" y2="8"/>
						<line id="minute-hand" x1="12" y1="12" x2="16" y2="12"/>
						<circle cx="12" cy="12" r="8"/>
					</svg>
					<span id="time">██:██:██</span>
				</div>
			</div>

			<div class="absolute bottom-0 right-0 m-4 flex gap-2">
				<a class="py-2 px-2  rounded-sm border-primary hover:brightness-125 border-2"
					href="https://github.com/CheryX" target="_blank">
					<img alt="Github" src="icons/github.svg" class="h-5">
				</a>
				<a class="py-2 px-2  rounded-sm border-primary hover:brightness-125 border-2"
					href="https://www.linkedin.com/in/monika-musielik-695624376/" target="_blank">
					<img alt="Linkedin" src="icons/linkedin.svg" class="h-5">
				</a>
			</div>

			<!-- <div class="absolute bottom-0 left-0 m-4 rounded-md hidden lg:block">
				<img src="mizuki-akiyama.gif" alt="Mizuki Akiyama" class="rounded-t-md" />
				<p class="bg-white text-black text-center py-1 rounded-b-md">mizuki akiyama dance :3</p>
			</div> -->

			<div class="text-center z-10 px-4">
				<h1 class="text-7xl lg:text-[150px] leading-none text-primary font-extrabold m-0 p-0">
					Monika
				</h1>
				<div class="flex gap-2 items-center justify-center relative group pb-8">
                    <p class="text-lg text-text/80 leading-none font-sans" id="subtitle">████████████ ████████</p>
                    <button id="shuffle_button" class="absolute opacity-0 right-0 scale-95 transition-opacity
                        group-hover:opacity-70 cursor-pointer p-1 rounded-md border-text/40 hover:brightness-125
                        border-2 hover:scale-[0.90] active:opacity-[0.5]">
                        <img alt="Shuffle" src="icons/shuffle.svg" class="h-5">
                    </button>
                </div>
			</div>
			<div class="my-8 w-full p-2 invisible border-y-2 h-[7ch] lg:h-[1ch]"></div>
		</section>

		<div class="bg-black">
			<section class="font-display max-w-6xl px-8 lg:px-24 mx-auto py-12 text-text">
				<h1 class="mb-8 text-3xl font-bold">random stuff™ i made</h1>
				<div class="flex flex-col lg:grid grid-cols-3 gap-6 *:hover:brightness-125">
					<a class="p-6 border-2 border-primary rounded-md"
					   href="https://github.com/Kochanowski-js/kochanowski.js" target="_blank">
						<div class="flex gap-2 justify-between">
							<h2 class="text-2xl font-extrabold">KPL</h2>
							<img src="logos/kpl.png" alt="KPL Logo" class="h-12 rounded-sm" />
						</div>
						<p class="mt-6 font-sans font-light">Fun programming language based on the polish language.</p>
					</a>
					<a class="p-6 border-2 border-primary rounded-md"
					   href="https://play.google.com/store/apps/details?id=com.musielik.streakly" target="_blank">
						<div class="flex gap-2 justify-between">
							<h2 class="text-2xl font-extrabold">Streakly</h2>
							<img src="logos/streakly.png" alt="Streakly Logo" class="h-12 rounded-sm" />
						</div>
						<p class="mt-6 font-sans font-light">Habits and streak tracker designed to keep you motivated.</p>
					</a>
					<a class="p-6 border-2 border-primary rounded-md"
					   href="https://pobiegajmy.pl/" target="_blank">
						<div class="flex gap-2 justify-between">
							<h2 class="text-2xl font-extrabold">Pobiegajmy.pl</h2>
							<img src="logos/pobiegajmy.png" alt="Pobiegajmy Logo" class="h-12 rounded-sm" />
						</div>
						<p class="mt-6 font-sans font-light">Training and run browser with a dedicated running calculator.</p>
					</a>
				</div>
			</section>
		</div>

		<!-- separator -->
		<div class="bg-black py-4">
			<div class="bg-pattern bg-repeat-x bg-center bg-size-[40px] py-14"></div>
		</div>

		<div class="bg-black">
			<section class="max-w-6xl px-8 lg:px-24 mx-auto pt-12 pb-24 text-text">
				<h1 class="font-display mb-8 text-3xl font-bold">
					<span class="flex flex-wrap items-center">
						my devblog for my 
						<img src="logos/zabki.png" alt="Podziemia Ząbek's logo" class="w-8 mx-2 rounded-md" />
						<span class="text-indigo-500 inline">new game&nbsp;</span>
						i'm working on
					</span>
				</h1>
			</section>
		</div>

	</body>
</html>

<script>
	const weather = document.getElementById('weather') as HTMLSpanElement;
	const weatherData = await fetch("https://danepubliczne.imgw.pl/api/data/synop/station/warszawa")
		.then((res) => res.json());

	weather.innerText = weatherData.temperatura + "°C";

	const time = document.getElementById('time') as HTMLSpanElement;
	time.innerText = new Date().toTimeString().slice(0, 8);
	setInterval(() => time.innerText = new Date().toTimeString().slice(0, 8), 1000);

	const spotify = document.getElementById('spotify') as HTMLSpanElement;
	const spotifyCover = document.getElementById('spotify_cover') as HTMLImageElement;
	const spotifyLink = document.getElementById('spotify_link') as HTMLAnchorElement;

	const spotifyData = await fetch("https://api.lanyard.rest/v1/users/344491989691269151")
		.then((res) => res.json())
		.then((res) => res.data.spotify);

	function formatSpotifyTitle(artist: string, song: string) {
		const MAX_LENGTH = 40;

		song = song.replace(/\s*\(feat\..*?\)/i, '');

		let fullTitle = `${artist} • ${song}`.trim();
		if (fullTitle.length > MAX_LENGTH) {
			fullTitle = song;
		}

		return fullTitle;
	}

	if (spotifyData) {
		spotifyCover.src = spotifyData.album_art_url;
		spotifyCover.alt = "Cover of " + spotifyData.artist + " • " + spotifyData.song
		spotify.innerText = formatSpotifyTitle(spotifyData.artist, spotifyData.song);
		spotifyLink.href = "https://open.spotify.com/track/" + spotifyData.track_id;
	} else {
		spotify.innerText = "-- • --"
		spotifyLink.classList.remove("hover:underline");
	}

	function updateClock() {
		const now = new Date();
		const hours = now.getHours() % 12;
		const minutes = now.getMinutes();

		const hourDeg = (360 / 12) * hours + (30 * (minutes / 60));
		const minuteDeg = (360 / 60) * minutes;

		document.getElementById("hour-hand")!.setAttribute("transform", `rotate(${hourDeg} 12 12)`);
		document.getElementById("minute-hand")!.setAttribute("transform", `rotate(${minuteDeg - 90} 12 12)`);
	}

	updateClock();
	setInterval(updateClock, 60 * 1000); // Update every minute

	function classifyWeather() {
		const rain = parseFloat(weatherData.suma_opadu);
		const humidity = parseFloat(weatherData.wilgotnosc_wzgledna);

		if (rain > 5) return "rain";
		if (humidity >= 80) return "cloudy";
		return "sunny";
	}

	const weatherIcon = document.getElementById('weather_icon') as HTMLImageElement;
	weatherIcon.src = "/icons/weather_" + classifyWeather() + ".svg";
	weatherIcon.alt = "Weather icon";

	const subtitle = document.getElementById('subtitle') as HTMLParagraphElement;
	const subtitles = [
		":3", "i got into uni!!!", "a friendly neighbourhood catgirl",
		"i have no idea what to type here",
		"mizuki akiyama is my twin", "i am the original starwalker",
		"i wanna do a mizuki cosplay in december btw", "beware of the cutie who speaks with paws",
		"why do i share my spotify status up there? idk", "roll the katamari!!!", "update: mafuyu is now my twin",
        "blahajs power or something idk", "why are you here.", "update: update: i think mizuki is again my twin",
		"mizuena my beloved :3"
	]

    function shuffleSubtitle() {
        let newSubtitle;

        // holy hell i used a do.while loop
        do {
            newSubtitle = subtitles[Math.floor(Math.random() * subtitles.length)];
        } while (newSubtitle === subtitle.innerText && subtitles.length > 1);

        subtitle.innerText = newSubtitle;
    }

    shuffleSubtitle();

    const shuffleButton = document.getElementById('shuffle_button') as HTMLButtonElement;
    shuffleButton.addEventListener('click', () => shuffleSubtitle());

</script>

<script>
	import { createNoise3D } from "../scripts/perlin";

	const canvas = document.getElementById("grid") as HTMLCanvasElement;
	const ctx = canvas.getContext("2d") as CanvasRenderingContext2D;

	const noise3D = createNoise3D();

	// Grid
	const scale = 10;
	let cols = Math.floor(canvas.width / scale) + 1;
	let rows = Math.floor(canvas.height / scale) + 2;
	const thresholds = [0.2, 0.4, 0.6, 0.8];
	let t = 0;

	// Generate noise field
	function generateField() {
		const field: number[][] = [];
		for (let y = 0; y < rows; y++) {
			field[y] = [];
			for (let x = 0; x < cols; x++) {
				const nx = x * 0.05;
				const ny = y * 0.05;
				field[y][x] = noise3D(nx, ny, t) * 0.5 + 0.5; // Normalize to 0–1
			}
		}
		return field;
	}

	// Draw contour lines with marching squares
	function drawContours(field: number[][]) {
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.strokeStyle = "#ffffff20";
		ctx.lineWidth = 1;

		const drawLine = (x1: number, y1: number, x2: number, y2: number) => {
			ctx.beginPath();
			ctx.moveTo(x1, y1);
			ctx.lineTo(x2, y2);
			ctx.stroke();
		};

		for (const threshold of thresholds) {
			for (let y = 0; y < rows - 1; y++) {
				for (let x = 0; x < cols - 1; x++) {
					const tl = field[y][x] > threshold ? 1 : 0;
					const tr = field[y][x + 1] > threshold ? 1 : 0;
					const br = field[y + 1][x + 1] > threshold ? 1 : 0;
					const bl = field[y + 1][x] > threshold ? 1 : 0;
					const state = (tl << 3) | (tr << 2) | (br << 1) | bl;

					const px = x * scale;
					const py = y * scale;
					const mid = scale / 2;

					switch (state) {
						case 1: case 14: drawLine(px, py + mid, px + mid, py + scale); break;
						case 2: case 13: drawLine(px + mid, py + scale, px + scale, py + mid); break;
						case 3: case 12: drawLine(px, py + mid, px + scale, py + mid); break;
						case 4: case 11: drawLine(px + scale, py + mid, px + mid, py); break;
						case 5: drawLine(px, py + mid, px + mid, py);
							drawLine(px + mid, py + scale, px + scale, py + mid); break;
						case 6: case 9: drawLine(px + mid, py, px + mid, py + scale); break;
						case 7: case 8: drawLine(px, py + mid, px + mid, py); break;
						case 10: drawLine(px + mid, py, px + scale, py + mid);
							drawLine(px, py + mid, px + mid, py + scale); break;
					}
				}
			}
		}
	}

	// Animate
	function animate() {
		const field = generateField();
		drawContours(field);
		t += 0.005;
		requestAnimationFrame(animate);
	}
	animate();

	function resizeCanvas() {
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		cols = Math.floor(canvas.width / scale) + 1;
		rows = Math.floor(canvas.height / scale) + 2;
	}

	window.addEventListener("resize", resizeCanvas);
	resizeCanvas();


</script>

<style>
	.bg-pattern {
		background-image: url("/pattern.svg");
	}
</style>
